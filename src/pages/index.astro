---
export const prerender = true
import { find } from '@/api/payload'
import EspaceCultureImg from '@/assets/imgs/espace-culture-nature.webp'

import FirstImg from '@/assets/imgs/home/1.png'
import TenthImg from '@/assets/imgs/home/10.png'
import EleventhImg from '@/assets/imgs/home/11.png'
import TwelfthImg from '@/assets/imgs/home/12.png'
import ThirteenthImg from '@/assets/imgs/home/13.png'
import FourteenthImg from '@/assets/imgs/home/14.png'
import FifteenthImg from '@/assets/imgs/home/15.png'
import SixteenthImg from '@/assets/imgs/home/16.png'
import SeventeenImg from '@/assets/imgs/home/17.png'
import EighteenImg from '@/assets/imgs/home/18.png'
import NineteenImg from '@/assets/imgs/home/19.png'
import SecondImg from '@/assets/imgs/home/2.png'
import TwentyImg from '@/assets/imgs/home/20.png'
import ThirdImg from '@/assets/imgs/home/3.png'
import FourthImg from '@/assets/imgs/home/4.png'
import FifthImg from '@/assets/imgs/home/5.png'
import SixthImg from '@/assets/imgs/home/6.png'
import SeventhImg from '@/assets/imgs/home/7.png'
import EighthImg from '@/assets/imgs/home/8.png'
import NinthImg from '@/assets/imgs/home/9.png'
import Section1Img from '@/assets/imgs/home/31.png'
import Section2Img from '@/assets/imgs/home/32.png'
import Section3Img from '@/assets/imgs/home/33.png'
import MyImage from '@/components/my-image.astro'
import { NewsletterForm } from '@/components/newsletter-form'
import { Button } from '@/components/ui/button'
import { createTranslator, I18n } from '@/i18n/translations'
import Layout from '@/layouts/layout.astro'
import { translatePublicField } from '@/lib/translate-fields'
import type { ArtVivant } from '@/types/art-vivant'
import type { Cinema } from '@/types/cinema'

const locale = (Astro.currentLocale || 'fr') as I18n
const t = createTranslator(locale)

const spectacles = await find<ArtVivant>('art_vivant', {
	limit: 4,
	locale,
	where: { type: { equals: 'evenement' } }
})

const latestEvents = spectacles.docs
	.map((item) => ({ ...item, _href: `/art-vivant/spectacle/${item.id}` }))
	.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())
	.slice(0, 4)

const seances = await find<Cinema>('cinema', {
	limit: 4,
	locale,
	where: {
		type: { equals: 'seance' }
	}
})
---

<Layout title={t('ACCUEIL_TITLE')}>
	<main>
		<section class="text-primary grid grid-cols-1 lg:grid-cols-3 gap-2 px-4 py-8 lg:px-10 lg:py-16">
			<header class="lg:col-span-2 flex w-full flex-col self-stretch pt-4 lg:pt-8 pb-8 lg:pb-0">
				<p class="text-md mb-8 lg:mb-20 tracking-widest uppercase">{t('HERO_LOCATION')}</p>
				<h1 class="mb-8 lg:mb-14 font-serif text-4xl lg:text-6xl capitalize">
					{t('HERO_TITLE_LINE1')}
					<span class="mt-5 block text-4xl lg:text-6xl font-light italic">{t('HERO_TITLE_LINE2')}</span>
				</h1>

				<p class="text-lg lg:text-xl tracking-wide text-black">
					{t('HERO_SUBTITLE')}
				</p>

				<nav class="mt-auto flex flex-wrap w-full gap-5 lg:gap-6 pt-10 lg:pt-20">
					<Button link="/art-vivant" className="p-6">
						{t('ART_VIVANT')}
					</Button>
					<Button link="/parc-national" className="p-6">
						{t('PARC_NATIONAL')}
					</Button>
					<Button link="/cinema" className="p-6">
						{t('CINEMA')}
					</Button>
					<Button link="/mediatheque" className="p-6">
						{t('MEDIATHEQUE')}
					</Button>
					<Button link="/exposition" className="p-6">
						{t('EXPOSITION')}
					</Button>
					<Button link="/jeune-public" className="p-6">
						{t('JEUNESSE')}
					</Button>
				</nav>
			</header>

			<div class="grid grid-cols-2 grid-rows-2 gap-5">
				<MyImage alt="" src={Section1Img} width={300} height={400} layout="fullWidth" class="col-span-1 row-span-1" />
				<MyImage alt="" src={Section2Img} width={300} height={820} layout="fullWidth" class="ol-span-1 row-span-2" />
				<MyImage alt="" src={Section3Img} width={300} height={400} layout="fullWidth" class="col-span-1 row-span-1" />
			</div>
		</section>

		<section class="section-default">
			<article class="grid grid-cols-1 lg:flex gap-4">
				<div class="lg:w-2/3">
					<h2 class="pb-2 lg:pb-3">{t('ESPACE_CULTURE_TITRE')}</h2>
					<p class="distinguished pb-3 lg:pb-6">{t('ESPACE_CULTURE_INTRO')}</p>
					<p>
						{t('ESPACE_CULTURE_DESC_PART1')}<br /><br />
						{t('ESPACE_CULTURE_DESC_PART2')}<br /><br />
						{t('ESPACE_CULTURE_DESC_PART3')}<br /><br />
						{t('ESPACE_CULTURE_DESC_PART4')}<br /><br />
						{t('ESPACE_CULTURE_DESC_PART5')}
					</p>
				</div>
				<div class="grid lg:w-1/3 grid-cols-3 gap-3 lg:gap-5">
					<MyImage alt="" src={FirstImg} width={400} height={160} layout="fullWidth" class="col-span-2" />
					<MyImage alt="" src={SecondImg} width={200} height={160} layout="fullWidth" class="col-span-1" />
					<MyImage alt="" src={ThirdImg} width={600} height={250} layout="fullWidth" class="col-span-3" />
					<MyImage alt="" src={FourthImg} width={200} height={160} layout="fullWidth" class="col-span-1" />
					<MyImage alt="" src={FifthImg} width={400} height={160} layout="fullWidth" class="col-span-2" />
				</div>
			</article>

			<Button link="/parc-national#evenements" className="mt-6 lg:mt-12 h-10 px-6 lg:h-12 lg:px-8"
				>{t('DECOUVREZ_PROCHAINS_EVENEMENTS')}</Button
			>
		</section>

		<section class="section-default bg-primary/20">
			<article class="grid grid-cols-1 lg:flex gap-5">
				<div class="lg:w-2/12 hidden lg:block">
					<MyImage alt="" src={SixthImg} width={300} height={330} layout="fullWidth" class="mb-6" />
					<MyImage alt="" src={SeventhImg} width={300} height={330} layout="fullWidth" />
				</div>
				<div class="lg:w-7/12">
					<h2 class="pb-2 lg:pb-3">{t('SPECTACLES_A_VENIR')}</h2>
					<p class="distinguished pb-3 lg:pb-6">{t('SPECTACLES_INTRO')}</p>
					<p>
						{t('ESPACE_CULTURE_DESC_PART1')}<br /><br />
						{t('ESPACE_CULTURE_DESC_PART2')}<br /><br />
						{t('ESPACE_CULTURE_DESC_PART3')}<br /> <br />
						{t('ESPACE_CULTURE_DESC_PART4')}<br /> <br />
						{t('ESPACE_CULTURE_DESC_PART5')}
					</p>
				</div>
				<div class="lg:w-3/12 hidden lg:block">
					<MyImage class="w-2/6" alt="" src={EighthImg} width={550} height={680} layout="fullWidth" />
				</div>
				<div class="grid grid-cols-2 gap-3 lg:hidden mt-4">
					<MyImage alt="" src={SixthImg} width={300} height={330} layout="fullWidth" class="max-h-40 " />
					<MyImage alt="" src={SeventhImg} width={300} height={330} layout="fullWidth" class="max-h-40 " />
					<MyImage alt="" src={EighthImg} width={550} height={680} layout="fullWidth" class="col-span-2 max-h-80 " />
				</div>
			</article>
			<div class="my-16 grid lg:grid-cols-4 grid-cols-1 md:grid-cols-2 place-items-center gap-x-4 gap-y-8 *:max-w-80">
				{
					latestEvents.map((item) => {
						const descText = item.description.root.children
							.flatMap((para) => para.children)
							.filter((child) => child.type === 'text')
							.map((child) => child.text)
							.join(' ')

						return (
							<article class="group relative col-span-1 w-full overflow-hidden bg-white shadow-sm">
								<div class="overflow-hidden">
									<MyImage
										src={item.thumbnail?.url}
										alt={item.thumbnail?.alt ?? t('IMAGE_PLACEHOLDER')}
										background={item.thumbnail?.blurhash}
										width={275}
										height={305}
										layout="fullWidth"
									/>
								</div>
								<figure class="p-4 transition-opacity duration-250 group-hover:opacity-0">
									<figcaption>
										<h3 class="pb-3 text-black">
											<a href={item._href} class="after:absolute after:inset-0 after:z-10">
												{item.title}
											</a>
										</h3>
										<p class="distinguished text-primary pb-1 text-xs">{item.genre}</p>
										<time class="distinguished text-sm capitalize" datetime={item.date_start}>
											{new Date(item.date_start).toLocaleDateString(locale, { dateStyle: 'full' })} -{' '}
											{new Date(item.date_start).toLocaleTimeString(locale, {
												hour: '2-digit',
												minute: '2-digit',
												hour12: false
											})}
										</time>
									</figcaption>
								</figure>
								<div class="bg-primary/80 pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-250 group-hover:opacity-100" />
								<figure class="pointer-events-none absolute inset-0 p-5 opacity-0 transition-opacity duration-250 group-hover:opacity-100">
									<figcaption class="text-white">
										<p class="line-clamp-8 text-sm">{descText}</p>
										<p class="inline-flex items-center gap-2 pt-10 text-sm font-semibold underline underline-offset-2">
											{t('EN_SAVOIR_PLUS')}
											<svg
												xmlns="http://www.w3.org/2000/svg"
												width="16"
												height="16"
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
											>
												<path d="M5 12h14" />
												<path d="m12 5 7 7-7 7" />
											</svg>
										</p>
									</figcaption>
								</figure>
							</article>
						)
					})
				}
			</div>

			<Button link="/art-vivant#spectacles" size={'xl'}>{t('VOIR_TOUS_SPECTACLES')}</Button>
		</section>

		<section>
			<div class="hidden lg:grid grid-cols-8 gap-5 pt-30">
				<MyImage src={NinthImg} alt="" width={200} height={460} layout="fullWidth" class="col-span-1 row-span-2" />
				<MyImage src={TenthImg} alt="" width={1300} height={460} layout="fullWidth" class="col-span-6 row-span-2" />
				<MyImage src={EleventhImg} alt="" width={200} height={460} layout="fullWidth" class="col-span-1 row-span-1" />
			</div>
			<div class="grid lg:hidden grid-cols-2 gap-3 pt-14 px-5">
				<MyImage src={TenthImg} alt="" width={1300} height={460} layout="fullWidth" class="col-span-2 max-h-48" />
				<MyImage src={NinthImg} alt="" width={200} height={460} layout="fullWidth" class="max-h-40" />
				<MyImage src={EleventhImg} alt="" width={200} height={460} layout="fullWidth" class="max-h-40" />
			</div>
			<div class="section-default pt-6 lg:pt-12">
				<div class="lg:w-2/3">
					<h2 class="pb-2 lg:pb-3">{t('SEANCES_A_VENIR')}</h2>
					<p class="distinguished pb-3 lg:pb-6">{t('CINEMA_INTRO')}</p>
					<p class="lg:w-2/3">
						{t('CINEMA_DESC_PART1')}
					</p>
				</div>

				<div class="my-8 lg:my-16 grid grid-cols-1 lg:grid-cols-2 gap-3 lg:gap-5">
					{
						seances.docs.map((item) => {
							const synopsisText = item.synopsis.root.children
								.flatMap((para) => para.children)
								.filter((child) => child.type === 'text')
								.map((child) => child.text)
								.join(' ')

							return (
								<article class="group relative col-span-1 w-full overflow-hidden bg-white shadow-sm">
									<div class="overflow-hidden">
										<MyImage
											src={item.thumbnail?.url}
											alt={item.thumbnail?.alt ?? t('IMAGE_PLACEHOLDER')}
											background={item.thumbnail?.blurhash}
											width={900}
											height={145}
											layout="fullWidth"
										/>
									</div>
									<figure class="p-4 transition-opacity duration-250 group-hover:opacity-0">
										<figcaption>
											<h3 class="pb-3 text-black">
												<a href={`/cinema/seance/${item.id}`} class="after:absolute after:inset-0 after:z-10">
													{item.title}
												</a>
											</h3>
											<p class="distinguished text-primary pb-1 text-xs">
												{translatePublicField(item.public, t)} - {item.genre} - {item.languages}
											</p>
											<p class="font-serif text-sm capitalize">
												{new Date(item.date_start).toLocaleDateString(locale, { dateStyle: 'full' })} -{' '}
												{new Date(item.date_start).toLocaleTimeString(locale, {
													hour: '2-digit',
													minute: '2-digit',
													hour12: false
												})}
											</p>
										</figcaption>
									</figure>
									<div class="bg-primary/80 pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-250 group-hover:opacity-100" />
									<figure class="pointer-events-none absolute inset-0 p-5 opacity-0 transition-opacity duration-250 group-hover:opacity-100">
										<figcaption class="text-white">
											<p class="line-clamp-6 text-sm">{synopsisText}</p>
											<p class="inline-flex items-center gap-2 pt-10 text-sm font-semibold underline underline-offset-2">
												{t('EN_SAVOIR_PLUS')}
												<svg
													xmlns="http://www.w3.org/2000/svg"
													width="16"
													height="16"
													viewBox="0 0 24 24"
													fill="none"
													stroke="currentColor"
													stroke-width="2"
													stroke-linecap="round"
													stroke-linejoin="round"
												>
													<path d="M5 12h14" />
													<path d="m12 5 7 7-7 7" />
												</svg>
											</p>
										</figcaption>
									</figure>
								</article>
							)
						})
					}
				</div>
				<Button link="/cinema#cinema" size={'xl'} className="mt-6 lg:mt-12">{t('VOIR_TOUTES_SEANCES')}</Button>
			</div>
		</section>

		<section class="section-default bg-secondary/20">
			<article class="grid grid-cols-1 lg:grid-cols-2 gap-5">
				<div class="flex flex-col">
					<h2 class="text-secondary pb-2 lg:pb-3">{t('EXPOSITIONS_TITRE')}</h2>
					<p class="distinguished pb-3 lg:pb-6">
						{t('EXPOSITIONS_INTRO')}
					</p>
					<p>
						{t('EXPOSITIONS_DESC')}
					</p>

					<Button variant={'secondary'} link="/exposition#exposition" size={'xl'} className="mt-6 lg:mt-auto w-fit"
						>{t('VOIR_EXPOSITION_MOMENT')}</Button
					>
				</div>
				<div class="space-y-3 lg:space-y-5">
					<!-- Top image full width -->
					<MyImage alt="" src={TwelfthImg} width={850} height={300} layout="fullWidth" />

					<!-- Bottom grid with 2 columns -->
					<div class="grid grid-cols-2 gap-3 lg:gap-5">
						<!-- Left column -->
						<div class="space-y-3 lg:space-y-5">
							<MyImage alt="" src={ThirteenthImg} width={400} height={180} layout="fullWidth" />
							<MyImage alt="" src={FifteenthImg} width={400} height={370} layout="fullWidth" />
						</div>

						<!-- Right column -->
						<div class="space-y-3 lg:space-y-5">
							<MyImage alt="" src={FourteenthImg} width={400} height={430} layout="fullWidth" />
							<MyImage alt="" src={SixteenthImg} width={400} height={120} layout="fullWidth" />
						</div>
					</div>
				</div>
			</article>
		</section>

		<section class="section-default">
			<article class="mx-auto max-w-200">
				<h2 class="text-secondary pb-2 lg:pb-4">{t('NEWSLETTER_TITRE')}</h2>
				<p class="pb-3 lg:pb-7 italic">{t('NEWSLETTER_INTRO')}</p>
				<p class="pb-8">{t('NEWSLETTER_DESC')}</p>

				<NewsletterForm client:load locale={locale} variant="default" apiBaseUrl={import.meta.env.PUBLIC_PAYLOAD_URL} />
			</article>
		</section>

		<section class="section-default bg-primary/20">
			<article class="grid grid-cols-1 lg:grid-cols-[1fr_2fr] gap-8 lg:gap-16">
				<!-- Right side: Content (first on mobile) -->
				<div class="lg:order-2">
					<h2 class="text-primary pb-2 lg:pb-3">{t('VALEURS_TITRE')}</h2>
					<p class="distinguished pb-3 lg:pb-6">{t('VALEURS_INTRO')}</p>
					<p>
						{t('VALEURS_DESC')}
					</p>
				</div>

				<!-- Left side: Images grid (second on mobile) -->
				<div class="grid grid-cols-2 gap-3 lg:gap-5 lg:order-1">
					<MyImage alt="" src={SeventeenImg} width={250} height={150} layout="fullWidth" />
					<MyImage alt="" src={EspaceCultureImg} width={250} height={150} layout="fullWidth" />
					<MyImage alt="" src={EighteenImg} width={400} height={200} layout="fullWidth" class="col-span-2" />
					<MyImage alt="" src={NineteenImg} width={250} height={150} layout="fullWidth" />
					<MyImage alt="" src={TwentyImg} width={250} height={150} layout="fullWidth" />
				</div>
			</article>
		</section>
	</main>
</Layout>

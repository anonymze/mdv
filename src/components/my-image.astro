---
import { Image as UnpicImage } from '@unpic/astro'
import type { ImageMetadata } from 'astro'
import PlaceholderImg from '@/assets/imgs/placeholder.webp'

export interface Props {
	src?: string | ImageMetadata | null
	alt: string
	width: number
	height: number
	loading?: 'lazy' | 'eager'
	priority?: boolean
	class?: string
	role?: any
	fetchpriority?: 'high' | 'low' | undefined
	aspectRatio?: number
	layout?: 'fixed' | 'constrained' | 'fullWidth'
	placeholder?: 'blur' | 'none'
	background?: string | null
	breakpoints?: number[]
	sizes?: string
}

const {
	src = PlaceholderImg,
	alt,
	width,
	height,
	background,
	loading,
	layout,
	priority,
	class: className,
	role,
	fetchpriority,
	aspectRatio,
	placeholder,
	breakpoints,
	sizes,
	...rest
} = Astro.props

const PAYLOAD_URL = import.meta.env.PUBLIC_PAYLOAD_URL

// Handle Astro image imports (ImageMetadata) and string URLs
let imageSrc: string | ImageMetadata

if (typeof src === 'string') {
	// String from API - prepend Payload URL
	imageSrc = `${PAYLOAD_URL}${src}`
} else if (src) {
	// ImageMetadata - use .src
	imageSrc = src.src
} else {
	// Null/undefined - use placeholder
	imageSrc = PlaceholderImg.src
}

// console.log(imageSrc)
---

<UnpicImage
	src={imageSrc}
	alt={alt}
	width={width}
	height={height}
	loading={loading}
	class={className}
	role={role}
	fetchpriority={fetchpriority}
	aspectRatio={aspectRatio}
	layout={layout}
	placeholder={placeholder}
	background={background ?? undefined}
	breakpoints={breakpoints}
	sizes={sizes}
	priority={priority}
	{...rest}
/>
